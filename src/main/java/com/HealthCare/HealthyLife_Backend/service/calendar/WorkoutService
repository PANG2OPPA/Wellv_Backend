package com.HealthCare.HealthyLife_Backend.service.calendar;

import com.HealthCare.HealthyLife_Backend.dto.calendar.WorkoutDto;
import com.HealthCare.HealthyLife_Backend.entity.calendar.Calendar;
import com.HealthCare.HealthyLife_Backend.entity.calendar.Workout;
import com.HealthCare.HealthyLife_Backend.repository.CalendarRepository;
import com.HealthCare.HealthyLife_Backend.repository.FoodRepository;
import com.HealthCare.HealthyLife_Backend.repository.MealRepository;
import com.HealthCare.HealthyLife_Backend.repository.MemberRepository;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
public class WorkoutService {

    private CalendarRepository calendarRepository;


    private MealRepository mealRepository;
    private FoodRepository foodRepository;
    private MemberRepository memberRepository;



    @Transactional
    public void addAndUpdateCalendar(WorkoutDto workoutDto) {
        // WorkoutDto로부터 Workout 엔티티 변환
        Workout workout = workoutDto.toWorkoutEntity(); // 이 메서드는 WorkoutDto를 Workout 엔티티로 변환

        // Workout의 regDate를 기반으로 Calendar 엔티티 찾기
        String regDate = workoutDto.getRegDate();
        Calendar calendar = calendarRepository.findByRegDateAndMemberEmail(regDate, workoutDto.getMemberEmail())
                .orElseGet(() -> {
                    // 새 Calendar 엔티티 생성 및 초기화
                    Calendar newCalendar = new Calendar();
                    newCalendar.setRegDate(regDate);
                    // Member 정보 설정 등 추가적인 초기화
                    return calendarRepository.save(newCalendar); // 새 Calendar 저장
                });

        // Workout에 Calendar 설정
        workout.setCalendar(calendar);

        // Workout 저장
        workoutRepository.save(workout);
    }
}
